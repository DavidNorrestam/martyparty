import"../chunks/DsnmJJEf.js";import{i as it}from"../chunks/DHGtLIgQ.js";import{c as ft,s as Y,e as lt,o as mt,g as bt}from"../chunks/CugV2zbh.js";import{h as et,p as ut,f as m,d as q,s as D,r as _,a9 as X,i as t,b as c,c as ct,aX as _t,$ as k,a2 as xt,as as st,at as wt,e as S,m as H,a5 as at,a7 as O,q as W}from"../chunks/B4DsnTPf.js";import{p as E,i as B,s as yt,a as qt}from"../chunks/BkCPHviF.js";import{e as dt,i as ht,q as L}from"../chunks/Cui-OkdZ.js";import{s as T}from"../chunks/LXU4N780.js";import{s as Mt,g as rt}from"../chunks/CbGh5ZAB.js";import{r as ot,a as jt}from"../chunks/C0-RSS78.js";function kt(r,i){return r==null?null:String(r)}function zt(r,i,d,M){var p=r.__style;if(et||p!==i){var e=kt(i);(!et||e!==r.getAttribute("style"))&&(e==null?r.removeAttribute("style"):r.style.cssText=e),r.__style=i}return M}var $t=m('<h3 class="svelte-1cbt2hp">Vad är det svenska namnet för växten på bilden?</h3>'),Rt=m('<h3 class="svelte-1cbt2hp">Vad är det latinska namnet för <span> </span>?</h3>'),Nt=m('<li class="svelte-1cbt2hp"><button type="button" class="mode-toggle svelte-1cbt2hp"> </button></li>'),Pt=m('<div class="quiz-question svelte-1cbt2hp"><!> <ul class="options-grid svelte-1cbt2hp"></ul></div>');function nt(r,i){ut(i,!1);let d=E(i,"question",8),M=E(i,"options",8),p=E(i,"mode",8,"latin");const e=ft();function N(l){e("answer",l)}it();var n=Pt(),U=q(n);{var F=l=>{var x=$t();c(l,x)},P=l=>{var x=Rt(),z=D(q(x)),A=q(z,!0);_(z),_t(),_(x),X(()=>Y(A,(xt(d()),k(()=>d().swedishName)))),c(l,x)};B(U,l=>{p()==="image-to-swedish"?l(F):l(P,!1)})}var I=D(U,2);dt(I,5,M,ht,(l,x)=>{var z=Nt(),A=q(z),G=q(A,!0);_(A),_(z),X(()=>Y(G,t(x))),lt("click",A,()=>N(t(x))),c(l,z)}),_(I),_(n),c(r,n),ct()}var At=m('<div class="quiz-progress svelte-4hxcfj" role="progressbar" tabindex="0"> <div class="progress-bar svelte-4hxcfj"><div class="progress svelte-4hxcfj"></div></div></div>');function Ct(r,i){let d=E(i,"current",8),M=E(i,"total",8);var p=At();T(p,"aria-valuemin",1);var e=q(p),N=D(e),n=q(N);_(N),_(p),X(()=>{T(p,"aria-valuenow",d()),T(p,"aria-valuemax",M()),Y(e,`Fråga ${d()??""} av ${M()??""} `),zt(n,`width: ${100*d()/M()}%`)}),c(r,p)}const Dt=()=>{const r=Mt;return{page:{subscribe:r.page.subscribe},navigating:{subscribe:r.navigating.subscribe},updated:r.updated}},It={subscribe(r){return Dt().page.subscribe(r)}};var Qt=m("<p>Laddar frågor...</p>"),St=m('<img alt="Växtbild" style="max-width:260px;max-height:320px;width:100%;height:320px;object-fit:cover;border-radius:12px;box-shadow:0 2px 12px #0002;background:#e5e7eb;"/>'),Lt=m('<div style="display:inline-block;width:100%;max-width:260px;height:320px;border-radius:12px;background:#e5e7eb;box-shadow:0 2px 12px #0002;position:relative;"><span style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#888;">Laddar bild...</span></div>'),Ut=m('<div style="text-align:center;margin-bottom:1em;display:flex;gap:1em;justify-content:center;overflow-x:auto;"><!></div> <!>',1),Vt=m("<!> <!>",1),Bt=m("<p>Inga frågor tillgängliga.</p>"),Et=m('<main><div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:1em;"><h2 style="margin:0;">Quizfrågor</h2> <button style="padding:0.3em 1em;font-size:1em;">Hem</button></div> <!></main>');function Yt(r,i){ut(i,!1);const d=()=>qt(L,"$quiz",M),[M,p]=yt(),e=H();let N=H(!0),n=H("latin");mt(async()=>{bt(It).url.searchParams.get("mode")==="image-to-swedish"?S(n,"image-to-swedish"):S(n,"latin");const w=L.subscribe(s=>{s.finished&&rt(ot("/result"))});L.subscribe(s=>{s.questions.length>0&&S(N,!1)});let a=await(await fetch(jt("/plants.json"))).json();for(let s=a.length-1;s>0;s--){const g=Math.floor(Math.random()*(s+1));[a[s],a[g]]=[a[g],a[s]]}if(t(n)==="image-to-swedish"){const s=await Promise.all(a.map(async g=>{let j=g.latinName.replace(/"[^"]*"|'[^']*'/g,"").replace(/\s+sp\.?$/i,"").trim();g.latinName.trim().toLowerCase()==="antirrhinum majus"&&(j=j.split(" ")[0]);try{const V=await(await fetch(`https://api.inaturalist.org/v1/taxa?q=${encodeURIComponent(j)}`)).json();if(!V.results||V.results.length===0)return[];const K=V.results[0].id,h=await(await fetch(`https://api.inaturalist.org/v1/taxa/${K}`)).json();let C=[];h.results&&h.results.length>0&&h.results[0].taxon_photos&&(C=h.results[0].taxon_photos.map(b=>b.photo?.medium_url||b.photo?.url).filter(Boolean));let o=Array.from(new Set(C));if(o.length<3)try{const $=await(await fetch(`https://api.inaturalist.org/v1/observations?taxon_name=${encodeURIComponent(j)}&photos=true`)).json();if($.results&&$.results.length>0){let R=$.results.flatMap(f=>(f.photos||[]).map(u=>u.medium_url||u.url)).filter(Boolean);for(let f=R.length-1;f>0;f--){const u=Math.floor(Math.random()*(f+1));[R[f],R[u]]=[R[u],R[f]]}for(const f of R){if(o.length>=3)break;o.includes(f)||o.push(f)}}}catch{}if(o.length>3){for(let b=o.length-1;b>0;b--){const $=Math.floor(Math.random()*(b+1));[o[b],o[$]]=[o[$],o[b]]}return o.slice(0,3)}else return o.length>0?o:[]}catch{return[]}}));L.start(a,s,t(n))}else L.start(a,void 0,t(n));return w});function U(v){L.answer(v)}function F(v){if(!t(e).questions.length)return[];if(t(n)==="image-to-swedish"){const w=t(e).questions[v].swedishName,y=t(e).questions.map(s=>s.swedishName),a=[w];for(;a.length<4&&y.length>a.length;){const s=y[Math.floor(Math.random()*y.length)];a.includes(s)||a.push(s)}return a.sort(()=>Math.random()-.5)}else{const w=t(e).questions[v].latinName,y=t(e).questions.map(s=>s.latinName),a=[w];for(;a.length<4&&y.length>a.length;){const s=y[Math.floor(Math.random()*y.length)];a.includes(s)||a.push(s)}return a.sort(()=>Math.random()-.5)}}let P=H([]);st(()=>d(),()=>{S(e,d())}),st(()=>(t(n),t(e),d()),()=>{t(n)==="image-to-swedish"&&t(e).questions.length&&!t(e).finished&&d().images?S(P,d().images[t(e).current]||[]):S(P,[])}),wt(),it();var I=Et(),l=q(I),x=D(q(l),2);_(l);var z=D(l,2);{var A=v=>{var w=Qt();c(v,w)},G=v=>{var w=at(),y=O(w);{var a=g=>{var j=Vt(),J=O(j);{let h=W(()=>(t(e),k(()=>t(e).current+1)));Ct(J,{get current(){return t(h)},get total(){return t(e),k(()=>t(e).questions.length)}})}var V=D(J,2);{var K=h=>{var C=Ut(),o=O(C),b=q(o);{var $=u=>{var Q=at(),pt=O(Q);dt(pt,1,()=>t(P),ht,(vt,gt)=>{var tt=St();X(()=>T(tt,"src",t(gt))),c(vt,tt)}),c(u,Q)},R=u=>{var Q=Lt();c(u,Q)};B(b,u=>{t(P),k(()=>t(P).length>0)?u($):u(R,!1)})}_(o);var f=D(o,2);{let u=W(()=>(t(e),k(()=>F(t(e).current))));nt(f,{get question(){return t(e),k(()=>t(e).questions[t(e).current])},get options(){return t(u)},get mode(){return t(n)},$$events:{answer:Q=>U(Q.detail)}})}c(h,C)},Z=h=>{{let C=W(()=>(t(e),k(()=>F(t(e).current))));nt(h,{get question(){return t(e),k(()=>t(e).questions[t(e).current])},get options(){return t(C)},get mode(){return t(n)},$$events:{answer:o=>U(o.detail)}})}};B(V,h=>{t(n)==="image-to-swedish"?h(K):h(Z,!1)})}c(g,j)},s=g=>{var j=Bt();c(g,j)};B(y,g=>{t(e),k(()=>t(e).questions.length&&!t(e).finished)?g(a):g(s,!1)},!0)}c(v,w)};B(z,v=>{t(N)?v(A):v(G,!1)})}_(I),lt("click",x,()=>rt(ot("/"))),c(r,I),ct(),p()}export{Yt as component};
