import"../chunks/DsnmJJEf.js";import{i as nt}from"../chunks/DHGtLIgQ.js";import{c as vt,s as Y,e as it,o as ft,g as mt}from"../chunks/CugV2zbh.js";import{h as et,p as lt,f as m,d as q,s as D,r as _,a9 as X,i as t,b as c,c as ut,aX as bt,$ as k,a2 as _t,as as st,at as xt,e as S,m as H,a5 as at,a7 as O,q as W}from"../chunks/B4DsnTPf.js";import{p as E,i as B,s as wt,a as yt}from"../chunks/BkCPHviF.js";import{e as ct,i as dt,q as L}from"../chunks/Cui-OkdZ.js";import{s as T}from"../chunks/LXU4N780.js";import{s as qt,g as rt}from"../chunks/BwJsE-Nw.js";import{a as Mt}from"../chunks/Dm2gcvhr.js";function jt(r,i){return r==null?null:String(r)}function kt(r,i,d,M){var p=r.__style;if(et||p!==i){var e=jt(i);(!et||e!==r.getAttribute("style"))&&(e==null?r.removeAttribute("style"):r.style.cssText=e),r.__style=i}return M}var zt=m('<h3 class="svelte-1cbt2hp">Vad är det svenska namnet för växten på bilden?</h3>'),$t=m('<h3 class="svelte-1cbt2hp">Vad är det latinska namnet för <span> </span>?</h3>'),Rt=m('<li class="svelte-1cbt2hp"><button type="button" class="mode-toggle svelte-1cbt2hp"> </button></li>'),Nt=m('<div class="quiz-question svelte-1cbt2hp"><!> <ul class="options-grid svelte-1cbt2hp"></ul></div>');function ot(r,i){lt(i,!1);let d=E(i,"question",8),M=E(i,"options",8),p=E(i,"mode",8,"latin");const e=vt();function N(l){e("answer",l)}nt();var n=Nt(),U=q(n);{var F=l=>{var x=zt();c(l,x)},P=l=>{var x=$t(),z=D(q(x)),A=q(z,!0);_(z),bt(),_(x),X(()=>Y(A,(_t(d()),k(()=>d().swedishName)))),c(l,x)};B(U,l=>{p()==="image-to-swedish"?l(F):l(P,!1)})}var I=D(U,2);ct(I,5,M,dt,(l,x)=>{var z=Rt(),A=q(z),G=q(A,!0);_(A),_(z),X(()=>Y(G,t(x))),it("click",A,()=>N(t(x))),c(l,z)}),_(I),_(n),c(r,n),ut()}var Pt=m('<div class="quiz-progress svelte-4hxcfj" role="progressbar" tabindex="0"> <div class="progress-bar svelte-4hxcfj"><div class="progress svelte-4hxcfj"></div></div></div>');function At(r,i){let d=E(i,"current",8),M=E(i,"total",8);var p=Pt();T(p,"aria-valuemin",1);var e=q(p),N=D(e),n=q(N);_(N),_(p),X(()=>{T(p,"aria-valuenow",d()),T(p,"aria-valuemax",M()),Y(e,`Fråga ${d()??""} av ${M()??""} `),kt(n,`width: ${100*d()/M()}%`)}),c(r,p)}const Ct=()=>{const r=qt;return{page:{subscribe:r.page.subscribe},navigating:{subscribe:r.navigating.subscribe},updated:r.updated}},Dt={subscribe(r){return Ct().page.subscribe(r)}};var It=m("<p>Laddar frågor...</p>"),Qt=m('<img alt="Växtbild" style="max-width:260px;max-height:320px;width:100%;height:320px;object-fit:cover;border-radius:12px;box-shadow:0 2px 12px #0002;background:#e5e7eb;"/>'),St=m('<div style="display:inline-block;width:100%;max-width:260px;height:320px;border-radius:12px;background:#e5e7eb;box-shadow:0 2px 12px #0002;position:relative;"><span style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#888;">Laddar bild...</span></div>'),Lt=m('<div style="text-align:center;margin-bottom:1em;display:flex;gap:1em;justify-content:center;"><!></div> <!>',1),Ut=m("<!> <!>",1),Vt=m("<p>Inga frågor tillgängliga.</p>"),Bt=m('<main><div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:1em;"><h2 style="margin:0;">Quizfrågor</h2> <button style="padding:0.3em 1em;font-size:1em;">Hem</button></div> <!></main>');function Wt(r,i){lt(i,!1);const d=()=>yt(L,"$quiz",M),[M,p]=wt(),e=H();let N=H(!0),n=H("latin");ft(async()=>{mt(Dt).url.searchParams.get("mode")==="image-to-swedish"?S(n,"image-to-swedish"):S(n,"latin");const w=L.subscribe(s=>{s.finished&&rt("/result")});L.subscribe(s=>{s.questions.length>0&&S(N,!1)});let a=await(await fetch(Mt("/plants.json"))).json();for(let s=a.length-1;s>0;s--){const v=Math.floor(Math.random()*(s+1));[a[s],a[v]]=[a[v],a[s]]}if(t(n)==="image-to-swedish"){const s=await Promise.all(a.map(async v=>{let j=v.latinName.replace(/"[^"]*"|'[^']*'/g,"").replace(/\s+sp\.?$/i,"").trim();v.latinName.trim().toLowerCase()==="antirrhinum majus"&&(j=j.split(" ")[0]);try{const V=await(await fetch(`https://api.inaturalist.org/v1/taxa?q=${encodeURIComponent(j)}`)).json();if(!V.results||V.results.length===0)return[];const K=V.results[0].id,h=await(await fetch(`https://api.inaturalist.org/v1/taxa/${K}`)).json();let C=[];h.results&&h.results.length>0&&h.results[0].taxon_photos&&(C=h.results[0].taxon_photos.map(b=>b.photo?.medium_url||b.photo?.url).filter(Boolean));let o=Array.from(new Set(C));if(o.length<3)try{const $=await(await fetch(`https://api.inaturalist.org/v1/observations?taxon_name=${encodeURIComponent(j)}&photos=true`)).json();if($.results&&$.results.length>0){let R=$.results.flatMap(f=>(f.photos||[]).map(u=>u.medium_url||u.url)).filter(Boolean);for(let f=R.length-1;f>0;f--){const u=Math.floor(Math.random()*(f+1));[R[f],R[u]]=[R[u],R[f]]}for(const f of R){if(o.length>=3)break;o.includes(f)||o.push(f)}}}catch{}if(o.length>3){for(let b=o.length-1;b>0;b--){const $=Math.floor(Math.random()*(b+1));[o[b],o[$]]=[o[$],o[b]]}return o.slice(0,3)}else return o.length>0?o:[]}catch{return[]}}));L.start(a,s,t(n))}else L.start(a,void 0,t(n));return w});function U(g){L.answer(g)}function F(g){if(!t(e).questions.length)return[];if(t(n)==="image-to-swedish"){const w=t(e).questions[g].swedishName,y=t(e).questions.map(s=>s.swedishName),a=[w];for(;a.length<4&&y.length>a.length;){const s=y[Math.floor(Math.random()*y.length)];a.includes(s)||a.push(s)}return a.sort(()=>Math.random()-.5)}else{const w=t(e).questions[g].latinName,y=t(e).questions.map(s=>s.latinName),a=[w];for(;a.length<4&&y.length>a.length;){const s=y[Math.floor(Math.random()*y.length)];a.includes(s)||a.push(s)}return a.sort(()=>Math.random()-.5)}}let P=H([]);st(()=>d(),()=>{S(e,d())}),st(()=>(t(n),t(e),d()),()=>{t(n)==="image-to-swedish"&&t(e).questions.length&&!t(e).finished&&d().images?S(P,d().images[t(e).current]||[]):S(P,[])}),xt(),nt();var I=Bt(),l=q(I),x=D(q(l),2);_(l);var z=D(l,2);{var A=g=>{var w=It();c(g,w)},G=g=>{var w=at(),y=O(w);{var a=v=>{var j=Ut(),J=O(j);{let h=W(()=>(t(e),k(()=>t(e).current+1)));At(J,{get current(){return t(h)},get total(){return t(e),k(()=>t(e).questions.length)}})}var V=D(J,2);{var K=h=>{var C=Lt(),o=O(C),b=q(o);{var $=u=>{var Q=at(),ht=O(Q);ct(ht,1,()=>t(P),dt,(pt,gt)=>{var tt=Qt();X(()=>T(tt,"src",t(gt))),c(pt,tt)}),c(u,Q)},R=u=>{var Q=St();c(u,Q)};B(b,u=>{t(P),k(()=>t(P).length>0)?u($):u(R,!1)})}_(o);var f=D(o,2);{let u=W(()=>(t(e),k(()=>F(t(e).current))));ot(f,{get question(){return t(e),k(()=>t(e).questions[t(e).current])},get options(){return t(u)},get mode(){return t(n)},$$events:{answer:Q=>U(Q.detail)}})}c(h,C)},Z=h=>{{let C=W(()=>(t(e),k(()=>F(t(e).current))));ot(h,{get question(){return t(e),k(()=>t(e).questions[t(e).current])},get options(){return t(C)},get mode(){return t(n)},$$events:{answer:o=>U(o.detail)}})}};B(V,h=>{t(n)==="image-to-swedish"?h(K):h(Z,!1)})}c(v,j)},s=v=>{var j=Vt();c(v,j)};B(y,v=>{t(e),k(()=>t(e).questions.length&&!t(e).finished)?v(a):v(s,!1)},!0)}c(g,w)};B(z,g=>{t(N)?g(A):g(G,!1)})}_(I),it("click",x,()=>rt("/")),c(r,I),ut(),p()}export{Wt as component};
