import"../chunks/DsnmJJEf.js";import{s as M,o as je}from"../chunks/Z9sIMUL2.js";import{p as ce,b as de,B as ae,d as b,M as Ce,N as Me,a,f as u,e as l,c as d,r as i,h as e,g as O,n as S,t as U,aM as Ne,aL as ie,aK as q,a3 as oe,s as n}from"../chunks/Bw5Y5IGr.js";import{c as Ae,r as ze,i as J}from"../chunks/BpWPLi4d.js";import{g as Oe,b as ke}from"../chunks/3dyzFflp.js";import{e as he,C as me,i as xe,B as ne,a as Pe,r as Se}from"../chunks/VAu88WOC.js";import{C as ge,a as fe,b as _e}from"../chunks/vfgOeDLm.js";import{I as Fe,P as Re,a as Ue}from"../chunks/Biw7iJxh.js";import{r as Be,c as Te,d as qe,s as Ie}from"../chunks/0tY7R5CY.js";function $e(z,t){ce(t,!0);/**
 * @license @lucide/svelte v0.515.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 */let x=ze(t,["$$slots","$$events","$$legacy"]);const L=[["path",{d:"M20 6 9 17l-5-5"}]];Fe(z,Ae({name:"check"},()=>x,{get iconNode(){return L},children:(C,v)=>{var y=ae(),m=b(y);Ce(m,()=>t.children??Me),a(C,y)},$$slots:{default:!0}})),de()}var De=u('<span class="flex items-center gap-2 text-sm font-normal text-green-600"><!> Preprocessed</span>'),Ge=u("<span> </span> <!>",1),We=u("<!> <!>",1),Je=u(`<div><p class="text-muted-foreground mb-4">Select a plant file to preprocess. Files that have already been preprocessed
    are marked with a checkmark.</p> <div class="grid gap-4"></div></div>`);function Ke(z,t){ce(t,!0);var x=Je(),L=l(d(x),2);he(L,21,()=>t.files,xe,(C,v)=>{me(C,{class:"cursor-pointer hover:border-primary transition-colors",onclick:()=>t.onselect(e(v).filename),children:(y,m)=>{ge(y,{children:(f,F)=>{var w=We(),I=b(w);fe(I,{class:"flex items-center justify-between",children:(p,g)=>{var o=Ge(),h=b(o),c=d(h,!0);i(h);var N=l(h,2);{var P=A=>{var K=De(),B=d(K);$e(B,{class:"w-4 h-4"}),S(),i(K),a(A,K)};J(N,A=>{e(v).isPreprocessed&&A(P)})}O(()=>M(c,e(v).filename)),a(p,o)},$$slots:{default:!0}});var _=l(I,2);_e(_,{children:(p,g)=>{S();var o=U();O(()=>M(o,`${e(v).plantCount??""} plants`)),a(p,o)},$$slots:{default:!0}}),a(f,w)},$$slots:{default:!0}})},$$slots:{default:!0}})}),i(L),i(x),a(z,x),de()}var He=u("<!> <!>",1),Qe=u('<label class="flex items-center gap-3 p-3 rounded-md border cursor-pointer hover:bg-muted/50 transition-colors"><input type="checkbox" class="w-4 h-4 cursor-pointer"/> <div class="flex-1"><p class="font-medium"> </p> <p class="text-sm text-muted-foreground"> </p></div></label>'),Ve=u('<div class="flex gap-2 mb-4"><!> <!></div> <div class="space-y-2"></div> <div class="mt-6 p-4 bg-muted rounded-md"><p class="text-sm"><strong>Selected for auto-processing:</strong> <br/> <strong>Manual curation needed:</strong> </p></div> <!>',1),Xe=u("<!> <!>",1),Ye=u("<div><!> <!></div>");function Ze(z,t){ce(t,!0);var x=Ye(),L=d(x);ne(L,{variant:"outline",get onclick(){return t.onback},class:"mb-4",children:(v,y)=>{S();var m=U("← Back to file selection");a(v,m)},$$slots:{default:!0}});var C=l(L,2);me(C,{class:"mb-4",children:(v,y)=>{var m=Xe(),f=b(m);ge(f,{children:(w,I)=>{var _=He(),p=b(_);fe(p,{children:(o,h)=>{S();var c=U("Select Plants for Automatic Processing");a(o,c)},$$slots:{default:!0}});var g=l(p,2);_e(g,{children:(o,h)=>{S();var c=U(`Plants that are selected will be automatically processed using
        iNaturalist API. Deselect plants that need manual image curation (e.g.,
        cultivars).`);a(o,c)},$$slots:{default:!0}}),a(w,_)},$$slots:{default:!0}});var F=l(f,2);Pe(F,{children:(w,I)=>{var _=Ve(),p=b(_),g=d(p);ne(g,{variant:"outline",size:"sm",get onclick(){return t.onselectall},children:(B,Z)=>{S();var $=U("Select All");a(B,$)},$$slots:{default:!0}});var o=l(g,2);ne(o,{variant:"outline",size:"sm",get onclick(){return t.ondeselectall},children:(B,Z)=>{S();var $=U("Deselect All");a(B,$)},$$slots:{default:!0}}),i(p);var h=l(p,2);he(h,21,()=>t.plants,xe,(B,Z,$)=>{var R=Qe(),j=d(R);Be(j),j.__change=()=>t.ontoggle($);var X=l(j,2),re=d(X),G=d(re,!0);i(re);var Y=l(re,2),ue=d(Y,!0);i(Y),i(X),i(R),O(ve=>{Te(j,ve),M(G,e(Z).latinName),M(ue,e(Z).swedishName)},[()=>t.selectedPlantIndices.has($)]),a(B,R)}),i(h);var c=l(h,2),N=d(c),P=l(d(N)),A=l(P,4);i(N),i(c);var K=l(c,2);ne(K,{get onclick(){return t.oncontinue},class:"mt-4 w-full",children:(B,Z)=>{S();var $=U("Continue to Image Selection");a(B,$)},$$slots:{default:!0}}),O(()=>{M(P,` ${t.selectedPlantIndices.size??""} / ${t.plants.length??""} `),M(A,` ${t.plants.length-t.selectedPlantIndices.size}`)}),a(w,_)},$$slots:{default:!0}}),a(v,m)},$$slots:{default:!0}}),i(x),a(z,x),de()}Ne(["change"]);function Ee(z,t){ce(t,!0);/**
 * @license @lucide/svelte v0.515.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 */let x=ze(t,["$$slots","$$events","$$legacy"]);const L=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56"}]];Fe(z,Ae({name:"loader-circle"},()=>x,{get iconNode(){return L},children:(C,v)=>{var y=ae(),m=b(y);Ce(m,()=>t.children??Me),a(C,y)},$$slots:{default:!0}})),de()}var et=u(` <br/> <span class="text-xs bg-muted px-2 py-1 rounded mt-2 inline-block"> </span> <br/> Select at least 10 representative images. Click on images to
        select/deselect.`,1),tt=u("<!> <!>",1),at=u('<div class="flex items-center justify-center py-12"><!></div>'),rt=u('<p class="text-muted-foreground text-center py-12">No images found automatically. Use the manual URL entry above.</p>'),st=(z,t,x)=>t.onremovemanual(e(x)),nt=u('<div class="flex items-center gap-2 p-2 bg-muted rounded-md"><!> <span class="text-xs truncate flex-1"> </span> <button type="button" class="text-destructive hover:text-destructive/80 text-xs">Remove</button></div>'),lt=u('<div class="mb-4"><p class="text-sm font-semibold mb-2"> </p> <div class="space-y-2"></div></div>'),ot=(z,t,x)=>t.ontoggle(e(x).url),it=u('<div class="absolute top-2 right-2 bg-primary rounded-full p-1"><!></div>'),ct=z=>z.stopPropagation(),dt=u('<button type="button" class="relative cursor-pointer group text-left"><div><img class="w-full h-full object-cover" loading="lazy"/></div> <!> <a target="_blank" rel="noopener noreferrer" class="text-xs text-muted-foreground hover:text-foreground mt-1 block truncate"> </a></button>'),ut=u('<div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>'),vt=u(`<div class="mb-4 p-4 bg-muted rounded-md"><p class="text-sm"><strong>Selected:</strong> </p> <!></div> <div class="mb-4 p-4 bg-blue-50 border border-blue-200 rounded-md"><p class="text-sm font-semibold mb-2">Manual Image URL Entry</p> <p class="text-xs text-muted-foreground mb-2">If automatic search isn't working, search Google Images manually and
          paste image URLs here:</p> <div class="flex gap-2"><!></div> <p class="text-xs text-muted-foreground mt-2">Tip: Right-click image in Google → "Copy image address"</p></div> <!> <!>`,1),mt=u("<!> <!>",1),gt=u("<div><!> <!></div>");function ft(z,t){ce(t,!0);var x=gt(),L=d(x);ne(L,{variant:"outline",get onclick(){return t.onback},class:"mb-4",children:(v,y)=>{S();var m=U("← Back to plant selection");a(v,m)},$$slots:{default:!0}});var C=l(L,2);me(C,{class:"mb-4",children:(v,y)=>{var m=mt(),f=b(m);ge(f,{children:(w,I)=>{var _=tt(),p=b(_);fe(p,{children:(o,h)=>{S();var c=U();O(()=>M(c,`Select Images for ${t.plant.latinName??""}`)),a(o,c)},$$slots:{default:!0}});var g=l(p,2);_e(g,{children:(o,h)=>{S();var c=et(),N=b(c),P=l(N,3),A=d(P);i(P),S(3),O(()=>{M(N,`${t.plant.swedishName??""} • Plant ${t.currentManualIndex+1} of ${t.totalManualPlants??""} `),M(A,`Search query: "${t.plant.latinName??""}"`)}),a(o,c)},$$slots:{default:!0}}),a(w,_)},$$slots:{default:!0}});var F=l(f,2);Pe(F,{children:(w,I)=>{var _=vt(),p=b(_),g=d(p),o=l(d(g));i(g);var h=l(g,2);{let $=ie(()=>t.selectedImages.size/10*100);Re(h,{get value(){return e($)},class:"mt-2"})}i(p);var c=l(p,2),N=l(d(c),4),P=d(N);Ue(P,{type:"text",placeholder:"Paste image URL and press Enter",onkeydown:$=>{if($.key==="Enter"){const R=$.currentTarget,j=R.value.trim();j&&(j.startsWith("http://")||j.startsWith("https://"))&&(t.onaddmanual(j),R.value="")}},class:"flex-1"}),i(N),S(2),i(c);var A=l(c,2);{var K=$=>{var R=at(),j=d(R);Ee(j,{class:"w-8 h-8 animate-spin text-muted-foreground"}),i(R),a($,R)},B=$=>{var R=ae(),j=b(R);{var X=G=>{var Y=rt();a(G,Y)},re=G=>{var Y=ae(),ue=b(Y);{var ve=se=>{var ee=lt(),s=d(ee),r=d(s);i(s);var k=l(s,2);he(k,21,()=>Array.from(t.selectedImages),xe,(T,D)=>{var E=nt(),H=d(E);$e(H,{class:"w-4 h-4 text-green-600 flex-shrink-0"});var W=l(H,2),le=d(W,!0);i(W);var Q=l(W,2);Q.__click=[st,t,D],i(E),O(()=>M(le,e(D))),a(T,E)}),i(k),i(ee),O(()=>M(r,`Manually Added Images (${t.selectedImages.size??""})`)),a(se,ee)},be=se=>{var ee=ut();he(ee,21,()=>t.imageResults,xe,(s,r)=>{var k=dt();k.__click=[ot,t,r];var T=d(k),D=d(T);i(T);var E=l(T,2);{var H=Q=>{var V=it(),te=d(V);$e(te,{class:"w-4 h-4 text-primary-foreground"}),i(V),a(Q,V)};J(E,Q=>{t.selectedImages.has(e(r).url)&&Q(H)})}var W=l(E,2);W.__click=[ct];var le=d(W,!0);i(W),i(k),O(Q=>{qe(T,1,`aspect-square rounded-md overflow-hidden border-2 ${Q??""} hover:border-primary/50 transition-colors`),Ie(D,"src",e(r).thumbnail),Ie(D,"alt",e(r).title||t.plant.latinName),Ie(W,"href",e(r).url),M(le,e(r).source)},[()=>t.selectedImages.has(e(r).url)?"border-primary":"border-transparent"]),a(s,k)}),i(ee),a(se,ee)};J(ue,se=>{t.imageResults.length===0?se(ve):se(be,!1)},!0)}a(G,Y)};J(j,G=>{t.imageResults.length===0&&t.selectedImages.size===0?G(X):G(re,!1)},!0)}a($,R)};J(A,$=>{t.loadingImages?$(K):$(B,!1)})}var Z=l(A,2);{let $=ie(()=>t.selectedImages.size<10);ne(Z,{get onclick(){return t.oncontinue},get disabled(){return e($)},class:"mt-6 w-full",children:(R,j)=>{S();var X=U();O(()=>M(X,t.currentManualIndex<t.totalManualPlants-1?"Next Plant":"Start Processing")),a(R,X)},$$slots:{default:!0}})}O(()=>M(o,` ${t.selectedImages.size??""} / minimum 10`)),a(w,_)},$$slots:{default:!0}}),a(v,m)},$$slots:{default:!0}}),i(x),a(z,x),de()}Ne(["click"]);var _t=u("<!> <!>",1),pt=u('<!> <div class="flex items-center justify-center py-8"><!></div>',1),ht=u("<!> <!>",1),xt=u("<!> Preprocessing Complete!",1),Pt=u("<!> <!>",1),$t=u('<div class="space-y-2"><p class="text-sm"><strong>Auto-processed plants:</strong> <br/> <strong>Manually curated plants:</strong> </p> <!></div>'),bt=u("<!> <!>",1);function yt(z,t){var x=ae(),L=b(x);{var C=y=>{me(y,{children:(m,f)=>{var F=ht(),w=b(F);ge(w,{children:(_,p)=>{var g=_t(),o=b(g);fe(o,{children:(c,N)=>{S();var P=U("Processing Plants...");a(c,P)},$$slots:{default:!0}});var h=l(o,2);_e(h,{children:(c,N)=>{S();var P=U();O(()=>M(P,t.status)),a(c,P)},$$slots:{default:!0}}),a(_,g)},$$slots:{default:!0}});var I=l(w,2);Pe(I,{children:(_,p)=>{var g=pt(),o=b(g);Re(o,{get value(){return t.progress}});var h=l(o,2),c=d(h);Ee(c,{class:"w-8 h-8 animate-spin text-muted-foreground"}),i(h),a(_,g)},$$slots:{default:!0}}),a(m,F)},$$slots:{default:!0}})},v=y=>{me(y,{children:(m,f)=>{var F=bt(),w=b(F);ge(w,{children:(_,p)=>{var g=Pt(),o=b(g);fe(o,{class:"flex items-center gap-2",children:(c,N)=>{var P=xt(),A=b(P);$e(A,{class:"w-6 h-6 text-green-600"}),S(),a(c,P)},$$slots:{default:!0}});var h=l(o,2);_e(h,{children:(c,N)=>{S();var P=U();O(()=>M(P,`Successfully preprocessed ${t.selectedFile??""}`)),a(c,P)},$$slots:{default:!0}}),a(_,g)},$$slots:{default:!0}});var I=l(w,2);Pe(I,{children:(_,p)=>{var g=$t(),o=d(g),h=l(d(o)),c=l(h,4);i(o);var N=l(o,2);ne(N,{get onclick(){return t.onreset},class:"mt-4",children:(P,A)=>{S();var K=U("Process Another File");a(P,K)},$$slots:{default:!0}}),i(g),O(()=>{M(h,` ${t.autoCount??""} `),M(c,` ${t.manualCount??""}`)}),a(_,g)},$$slots:{default:!0}}),a(m,F)},$$slots:{default:!0}})};J(L,y=>{t.isComplete?y(v,!1):y(C)})}a(z,x)}var wt=u('<p class="text-muted-foreground">Loading plant files...</p>'),It=u('<div class="bg-destructive/10 text-destructive p-4 rounded-md mb-4"><p class="font-semibold">Error</p> <p> </p> <!></div>'),kt=u('<div class="container mx-auto p-6 max-w-6xl"><h1 class="text-3xl font-bold mb-6">Interactive Plant Preprocessing</h1> <!> <!></div>');function Lt(z,t){ce(t,!0);let x=q(oe([])),L=q(!0),C=q(null),v=q("file-selection"),y=q(null),m=q(oe([])),f=q(oe(new Set)),F=q(0),w=q(oe([])),I=q(oe(new Set)),_=q(oe([])),p=q(!1),g=q(""),o=q(0);je(async()=>{{Oe(Se("/"));return}});async function h(s){n(y,s,!0);try{const r=await fetch(`${ke}/${s}`);if(!r.ok)throw new Error("Failed to load plants");n(m,await r.json(),!0),n(f,new Set(e(m).map((k,T)=>T)),!0),n(v,"plant-selection")}catch(r){n(C,r instanceof Error?r.message:"Failed to load plant data",!0)}}function c(s){e(f).has(s)?e(f).delete(s):e(f).add(s),n(f,e(f),!0)}function N(){n(f,new Set(e(m).map((s,r)=>r)),!0)}function P(){n(f,new Set,!0)}function A(){return e(m).filter((s,r)=>!e(f).has(r))}async function K(){const s=e(m).map((r,k)=>k).filter(r=>!e(f).has(r));if(s.length===0){await X();return}n(F,s[0],!0),n(w,[],!0),n(I,new Set,!0),n(v,"image-selection"),await B()}async function B(){const s=A()[e(F)-A().indexOf(e(m)[e(F)])];if(s){n(p,!0);try{const r=await fetch(`${ke}/api/google-images?q=${encodeURIComponent(s.latinName)}`);if(!r.ok)throw new Error("Failed to load images");const k=await r.json();n(_,k.results||[],!0)}catch(r){n(C,r instanceof Error?r.message:"Failed to load images",!0)}finally{n(p,!1)}}}function Z(s){const r=new Set(e(I));r.has(s)?r.delete(s):r.add(s),n(I,r,!0)}function $(s){const r=new Set(e(I));r.add(s),n(I,r,!0)}function R(s){const r=new Set(e(I));r.delete(s),n(I,r,!0)}async function j(){const s=e(m)[e(F)];e(w).push({latinName:s.latinName,swedishName:s.swedishName,photos:Array.from(e(I))});const r=A(),k=r.indexOf(s);k<r.length-1?(n(F,e(m).indexOf(r[k+1]),!0),n(I,new Set,!0),await B()):await X()}async function X(){n(v,"processing"),n(g,"Starting preprocessing..."),n(o,0);try{const s=e(f).size,r=e(w).length,k=s+r;n(g,`Processing ${k} plants (${s} automatic, ${r} manual)...`),n(o,10);const T=setInterval(()=>{e(o)<90&&n(o,e(o)+5)},500),D=await fetch(Se("/api/preprocess"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filename:e(y),autoProcessIndices:Array.from(e(f)),manualPlants:e(w)})});if(clearInterval(T),!D.ok)throw new Error("Preprocessing failed");n(o,100),n(g,"Complete!"),n(v,"complete")}catch(s){n(C,s instanceof Error?s.message:"Preprocessing failed",!0),n(v,"plant-selection")}}function re(){n(v,"file-selection"),n(y,null),n(m,[],!0),n(f,new Set,!0),n(w,[],!0),n(_,[],!0),n(I,new Set,!0),n(C,null)}var G=kt(),Y=l(d(G),2);{var ue=s=>{var r=wt();a(s,r)},ve=s=>{var r=ae(),k=b(r);{var T=D=>{var E=It(),H=l(d(E),2),W=d(H,!0);i(H);var le=l(H,2);ne(le,{variant:"outline",onclick:()=>n(C,null),class:"mt-2",children:(Q,V)=>{S();var te=U("Dismiss");a(Q,te)},$$slots:{default:!0}}),i(E),O(()=>M(W,e(C))),a(D,E)};J(k,D=>{e(C)&&D(T)},!0)}a(s,r)};J(Y,s=>{e(L)?s(ue):s(ve,!1)})}var be=l(Y,2);{var se=s=>{Ke(s,{get files(){return e(x)},onselect:h})},ee=s=>{var r=ae(),k=b(r);{var T=E=>{Ze(E,{get plants(){return e(m)},get selectedPlantIndices(){return e(f)},onback:re,oncontinue:K,ontoggle:c,onselectall:N,ondeselectall:P})},D=E=>{var H=ae(),W=b(H);{var le=V=>{const te=ie(()=>e(m)[e(F)]),pe=ie(A),ye=ie(()=>e(pe).indexOf(e(te)));ft(V,{get plant(){return e(te)},get currentManualIndex(){return e(ye)},get totalManualPlants(){return e(pe).length},get selectedImages(){return e(I)},get imageResults(){return e(_)},get loadingImages(){return e(p)},onback:()=>n(v,"plant-selection"),ontoggle:Z,onaddmanual:$,onremovemanual:R,oncontinue:j})},Q=V=>{var te=ae(),pe=b(te);{var ye=we=>{{let Le=ie(()=>e(v)==="complete");yt(we,{get status(){return e(g)},get progress(){return e(o)},get isComplete(){return e(Le)},get selectedFile(){return e(y)},get autoCount(){return e(f).size},get manualCount(){return e(w).length},onreset:re})}};J(pe,we=>{(e(v)==="processing"||e(v)==="complete")&&we(ye)},!0)}a(V,te)};J(W,V=>{e(v)==="image-selection"?V(le):V(Q,!1)},!0)}a(E,H)};J(k,E=>{e(v)==="plant-selection"?E(T):E(D,!1)},!0)}a(s,r)};J(be,s=>{e(v)==="file-selection"?s(se):s(ee,!1)})}i(G),a(z,G),de()}export{Lt as component};
