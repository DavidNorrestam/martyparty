import"../chunks/DsnmJJEf.js";import{o as We,s as N}from"../chunks/Ai-LNryd.js";import{p as Te,b as Be,a6 as te,d,a7 as Qe,a8 as Xe,a as e,a9 as $t,aa as le,ab as je,f as l,e as c,s,c as n,g as t,r as o,n as m,t as A,a5 as q,ac as Le}from"../chunks/BdU2Qewh.js";import{s as Ye,r as Ze,i as D}from"../chunks/QrMPNVZ5.js";import{e as Ce,i as Ne}from"../chunks/B0n3dYTo.js";import{r as ht,s as xt,a as Pt,b as Ue}from"../chunks/DVit7hfp.js";import{g as bt,b as Je}from"../chunks/IJSbyBPa.js";import{r as Oe,C as xe,a as Ae}from"../chunks/Dox1Eiq0.js";import{B as se}from"../chunks/DFPvdS-z.js";import{C as Pe,a as be,b as we}from"../chunks/DQmFOm4Y.js";import{I as et,P as He,a as wt}from"../chunks/CHCgbo8w.js";function ze(Z,R){Te(R,!0);/**
 * @license @lucide/svelte v0.515.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 */let V=Ze(R,["$$slots","$$events","$$legacy"]);const ie=[["path",{d:"M20 6 9 17l-5-5"}]];et(Z,Ye({name:"check"},()=>V,{get iconNode(){return ie},children:(L,z)=>{var K=te(),f=d(K);Qe(f,()=>R.children??Xe),e(L,K)},$$slots:{default:!0}})),Be()}function Ke(Z,R){Te(R,!0);/**
 * @license @lucide/svelte v0.515.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 */let V=Ze(R,["$$slots","$$events","$$legacy"]);const ie=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56"}]];et(Z,Ye({name:"loader-circle"},()=>V,{get iconNode(){return ie},children:(L,z)=>{var K=te(),f=d(K);Qe(f,()=>R.children??Xe),e(L,K)},$$slots:{default:!0}})),Be()}var yt=l('<p class="text-muted-foreground">Loading plant files...</p>'),It=l('<div class="bg-destructive/10 text-destructive p-4 rounded-md mb-4"><p class="font-semibold">Error</p> <p> </p> <!></div>'),kt=l('<span class="flex items-center gap-2 text-sm font-normal text-green-600"><!> Preprocessed</span>'),St=l("<span> </span> <!>",1),Ct=l("<!> <!>",1),Nt=l(`<div><p class="text-muted-foreground mb-4">Select a plant file to preprocess. Files that have already been
                preprocessed are marked with a checkmark.</p> <div class="grid gap-4"></div></div>`),At=l("<!> <!>",1),zt=l('<label class="flex items-center gap-3 p-3 rounded-md border cursor-pointer hover:bg-muted/50 transition-colors"><input type="checkbox" class="w-4 h-4 cursor-pointer"/> <div class="flex-1"><p class="font-medium"> </p> <p class="text-sm text-muted-foreground"> </p></div></label>'),Et=l('<div class="flex gap-2 mb-4"><!> <!></div> <div class="space-y-2"></div> <div class="mt-6 p-4 bg-muted rounded-md"><p class="text-sm"><strong>Selected for auto-processing:</strong> <br/> <strong>Manual curation needed:</strong> </p></div> <!>',1),Rt=l("<!> <!>",1),Ft=l("<div><!> <!></div>"),Mt=l(` <br/> <span class="text-xs bg-muted px-2 py-1 rounded mt-2 inline-block"> </span> <br/> Select at least 10 representative images. Click on images
                        to select/deselect.`,1),jt=l("<!> <!>",1),Lt=l('<div class="flex items-center justify-center py-12"><!></div>'),Ut=l(`<p class="text-muted-foreground text-center py-12">No images found automatically. Use the manual URL
                            entry above.</p>`),Ot=(Z,R)=>{const V=new Set(selectedImages);V.delete(R),selectedImages=V},Tt=l('<div class="flex items-center gap-2 p-2 bg-muted rounded-md"><!> <span class="text-xs truncate flex-1"> </span> <button type="button" class="text-destructive hover:text-destructive/80 text-xs">Remove</button></div>'),Bt=l('<div class="mb-4"><p class="text-sm font-semibold mb-2"></p> <div class="space-y-2"></div></div>'),qt=(Z,R,V)=>R(V.url),Dt=l('<div class="absolute top-2 right-2 bg-primary rounded-full p-1"><!></div>'),Vt=Z=>Z.stopPropagation(),Gt=l('<button type="button" class="relative cursor-pointer group text-left"><div><img class="w-full h-full object-cover" loading="lazy"/></div> <!> <a target="_blank" rel="noopener noreferrer" class="text-xs text-muted-foreground hover:text-foreground mt-1 block truncate"> </a></button>'),Wt=l('<div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>'),Jt=l(`<div class="mb-4 p-4 bg-muted rounded-md"><p class="text-sm"><strong>Selected:</strong> </p> <!></div> <div class="mb-4 p-4 bg-blue-50 border border-blue-200 rounded-md"><p class="text-sm font-semibold mb-2">Manual Image URL Entry</p> <p class="text-xs text-muted-foreground mb-2">If automatic search isn't working, search Google
                            Images manually and paste image URLs here:</p> <div class="flex gap-2"><!></div> <p class="text-xs text-muted-foreground mt-2">Tip: Right-click image in Google → "Copy image
                            address"</p></div> <!> <!>`,1),Ht=l("<!> <!>",1),Kt=l("<div><!> <!></div>"),Qt=l("<!> <!>",1),Xt=l('<!> <div class="flex items-center justify-center py-8"><!></div>',1),Yt=l("<!> <!>",1),Zt=l("<!> Preprocessing Complete!",1),ea=l("<!> <!>",1),ta=l('<div class="space-y-2"><p class="text-sm"><strong>Auto-processed plants:</strong> <br/> <strong>Manually curated plants:</strong> </p> <!></div>'),aa=l("<!> <!>",1),ra=l('<div class="container mx-auto p-6 max-w-6xl"><h1 class="text-3xl font-bold mb-6">Interactive Plant Preprocessing</h1> <!> <!></div>');function _a(Z,R){Te(R,!0);let V=le(je([])),ie=le(!0),L=le(null),z=le("file-selection"),K=le(null),f=le(je([])),g=le(je(new Set));We(async()=>{{bt(Oe("/"));return}}),We(async()=>{try{const a=await fetch(Oe("/api/preprocess"));if(!a.ok)throw new Error("Failed to load files");const r=await a.json();c(V,r.files,!0)}catch(a){c(L,a instanceof Error?a.message:"Unknown error",!0)}finally{c(ie,!1)}});async function tt(a){c(K,a,!0);try{const r=await fetch(`${Je}/${a}`);if(!r.ok)throw new Error("Failed to load plants");c(f,await r.json(),!0),c(g,new Set(t(f).map((x,ee)=>ee)),!0),c(z,"plant-selection")}catch(r){c(L,r instanceof Error?r.message:"Failed to load plant data",!0)}}function at(a){t(g).has(a)?t(g).delete(a):t(g).add(a),c(g,t(g),!0)}function rt(){c(g,new Set(t(f).map((a,r)=>r)),!0)}function st(){c(g,new Set,!0)}async function ot(){const a=t(f).map((r,x)=>x).filter(r=>!t(g).has(r));if(a.length===0){await De();return}currentPlantIndex=a[0],manualPlants=[],selectedImages=new Set,c(z,"image-selection"),await qe()}async function qe(){const a=ye()[currentPlantIndex-ye().indexOf(t(f)[currentPlantIndex])];if(a){loadingImages=!0;try{const r=await fetch(`${Je}/api/google-images?q=${encodeURIComponent(a.latinName)}`);if(!r.ok)throw new Error("Failed to load images");const x=await r.json();imageResults=x.results||[]}catch(r){c(L,r instanceof Error?r.message:"Failed to load images",!0)}finally{loadingImages=!1}}}function nt(a){const r=new Set(selectedImages);r.has(a)?r.delete(a):r.add(a),selectedImages=r}function ye(){return t(f).filter((a,r)=>!t(g).has(r))}async function lt(){const a=t(f)[currentPlantIndex];manualPlants.push({latinName:a.latinName,swedishName:a.swedishName,photos:Array.from(selectedImages)});const r=ye(),x=r.indexOf(a);x<r.length-1?(currentPlantIndex=t(f).indexOf(r[x+1]),selectedImages=new Set,await qe()):await De()}async function De(){c(z,"processing"),processingStatus="Starting preprocessing...",processingProgress=0;try{const a=t(g).size,r=manualPlants.length,x=a+r;processingStatus=`Processing ${x} plants (${a} automatic, ${r} manual)...`,processingProgress=10;const ee=setInterval(()=>{processingProgress<90&&(processingProgress+=5)},500),U=await fetch(Oe("/api/preprocess"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filename:t(K),autoProcessIndices:Array.from(t(g)),manualPlants})});if(clearInterval(ee),!U.ok)throw new Error("Preprocessing failed");processingProgress=100,processingStatus="Complete!",c(z,"complete")}catch(a){c(L,a instanceof Error?a.message:"Preprocessing failed",!0),c(z,"plant-selection")}}function Ve(){c(z,"file-selection"),c(K,null),c(f,[],!0),c(g,new Set,!0),manualPlants=[],imageResults=[],selectedImages=new Set,c(L,null)}var Ee=ra(),Ge=s(n(Ee),2);{var it=a=>{var r=yt();e(a,r)},ct=a=>{var r=te(),x=d(r);{var ee=U=>{var O=It(),G=s(n(O),2),ae=n(G,!0);o(G);var ce=s(G,2);se(ce,{variant:"outline",onclick:()=>c(L,null),class:"mt-2",children:(Q,T)=>{m();var $=A("Dismiss");e(Q,$)},$$slots:{default:!0}}),o(O),q(()=>N(ae,t(L))),e(U,O)};D(x,U=>{t(L)&&U(ee)},!0)}e(a,r)};D(Ge,a=>{t(ie)?a(it):a(ct,!1)})}var dt=s(Ge,2);{var vt=a=>{var r=Nt(),x=s(n(r),2);Ce(x,21,()=>t(V),Ne,(ee,U)=>{xe(ee,{class:"cursor-pointer hover:border-primary transition-colors",onclick:()=>tt(t(U).filename),children:(O,G)=>{Pe(O,{children:(ae,ce)=>{var Q=Ct(),T=d(Q);be(T,{class:"flex items-center justify-between",children:(B,re)=>{var I=St(),k=d(I),E=n(k,!0);o(k);var S=s(k,2);{var F=v=>{var P=kt(),b=n(P);ze(b,{class:"w-4 h-4"}),m(),o(P),e(v,P)};D(S,v=>{t(U).isPreprocessed&&v(F)})}q(()=>N(E,t(U).filename)),e(B,I)},$$slots:{default:!0}});var $=s(T,2);we($,{children:(B,re)=>{m();var I=A();q(()=>N(I,`${t(U).plantCount??""} plants`)),e(B,I)},$$slots:{default:!0}}),e(ae,Q)},$$slots:{default:!0}})},$$slots:{default:!0}})}),o(x),o(r),e(a,r)},ut=a=>{var r=te(),x=d(r);{var ee=O=>{var G=Ft(),ae=n(G);se(ae,{variant:"outline",onclick:Ve,class:"mb-4",children:(Q,T)=>{m();var $=A("← Back to file selection");e(Q,$)},$$slots:{default:!0}});var ce=s(ae,2);xe(ce,{class:"mb-4",children:(Q,T)=>{var $=Rt(),B=d($);Pe(B,{children:(I,k)=>{var E=At(),S=d(E);be(S,{children:(v,P)=>{m();var b=A("Select Plants for Automatic Processing");e(v,b)},$$slots:{default:!0}});var F=s(S,2);we(F,{children:(v,P)=>{m();var b=A(`Plants that are selected will be automatically processed
                        using iNaturalist API. Deselect plants that need manual
                        image curation (e.g., cultivars).`);e(v,b)},$$slots:{default:!0}}),e(I,E)},$$slots:{default:!0}});var re=s(B,2);Ae(re,{children:(I,k)=>{var E=Et(),S=d(E),F=n(S);se(F,{variant:"outline",size:"sm",onclick:rt,children:(u,p)=>{m();var i=A("Select All");e(u,i)},$$slots:{default:!0}});var v=s(F,2);se(v,{variant:"outline",size:"sm",onclick:st,children:(u,p)=>{m();var i=A("Deselect All");e(u,i)},$$slots:{default:!0}}),o(S);var P=s(S,2);Ce(P,21,()=>t(f),Ne,(u,p,i)=>{var _=zt(),w=n(_);ht(w),w.__change=()=>at(i);var J=s(w,2),y=n(J),de=n(y,!0);o(y);var ve=s(y,2),Re=n(ve,!0);o(ve),o(J),o(_),q(j=>{xt(w,j),N(de,t(p).latinName),N(Re,t(p).swedishName)},[()=>t(g).has(i)]),e(u,_)}),o(P);var b=s(P,2),W=n(b),M=s(n(W)),C=s(M,4);o(W),o(b);var h=s(b,2);se(h,{onclick:ot,class:"mt-4 w-full",children:(u,p)=>{m();var i=A("Continue to Image Selection");e(u,i)},$$slots:{default:!0}}),q(()=>{N(M,` ${t(g).size??""} / ${t(f).length??""} `),N(C,` ${t(f).length-t(g).size}`)}),e(I,E)},$$slots:{default:!0}}),e(Q,$)},$$slots:{default:!0}}),o(G),e(O,G)},U=O=>{var G=te(),ae=d(G);{var ce=T=>{const $=Le(()=>t(f)[currentPlantIndex]),B=Le(ye),re=Le(()=>t(B).indexOf(t($)));var I=Kt(),k=n(I);se(k,{variant:"outline",onclick:()=>c(z,"plant-selection"),class:"mb-4",children:(S,F)=>{m();var v=A("← Back to plant selection");e(S,v)},$$slots:{default:!0}});var E=s(k,2);xe(E,{class:"mb-4",children:(S,F)=>{var v=Ht(),P=d(v);Pe(P,{children:(W,M)=>{var C=jt(),h=d(C);be(h,{children:(p,i)=>{m();var _=A();q(()=>N(_,`Select Images for ${t($).latinName??""}`)),e(p,_)},$$slots:{default:!0}});var u=s(h,2);we(u,{children:(p,i)=>{m();var _=Mt(),w=d(_),J=s(w,3),y=n(J);o(J),m(3),q(()=>{N(w,`${t($).swedishName??""} • Plant ${t(re)+1} of ${t(B).length??""} `),N(y,`Search query: "${t($).latinName??""}"`)}),e(p,_)},$$slots:{default:!0}}),e(W,C)},$$slots:{default:!0}});var b=s(P,2);Ae(b,{children:(W,M)=>{var C=Jt(),h=d(C),u=n(h),p=s(n(u));p.nodeValue=` ${selectedImages.size??""} / minimum 10`,o(u);var i=s(u,2);He(i,{value:selectedImages.size/10*100,class:"mt-2"}),o(h);var _=s(h,2),w=s(n(_),4),J=n(w);wt(J,{type:"text",placeholder:"Paste image URL and press Enter",onkeydown:j=>{if(j.key==="Enter"){const X=j.currentTarget,H=X.value.trim();if(H&&(H.startsWith("http://")||H.startsWith("https://"))){const Ie=new Set(selectedImages);Ie.add(H),selectedImages=Ie,X.value=""}}},class:"flex-1"}),o(w),m(2),o(_);var y=s(_,2);{var de=j=>{var X=Lt(),H=n(X);Ke(H,{class:"w-8 h-8 animate-spin text-muted-foreground"}),o(X),e(j,X)},ve=j=>{var X=te(),H=d(X);{var Ie=ue=>{var ke=Ut();e(ue,ke)},pt=ue=>{var ke=te(),mt=d(ke);{var _t=pe=>{var oe=Bt(),Se=n(oe);Se.textContent=`Manually Added Images (${selectedImages.size??""})`;var Y=s(Se,2);Ce(Y,20,()=>Array.from(selectedImages),Ne,(me,ne)=>{var _e=Tt(),ge=n(_e);ze(ge,{class:"w-4 h-4 text-green-600 flex-shrink-0"});var $e=s(ge,2),fe=n($e,!0);o($e);var Fe=s($e,2);Fe.__click=[Ot,ne],o(_e),q(()=>N(fe,ne)),e(me,_e)}),o(Y),o(oe),e(pe,oe)},ft=pe=>{var oe=Wt();Ce(oe,20,()=>imageResults,Ne,(Se,Y)=>{var me=Gt();me.__click=[qt,nt,Y];var ne=n(me),_e=n(ne);o(ne);var ge=s(ne,2);{var $e=he=>{var Me=Dt(),gt=n(Me);ze(gt,{class:"w-4 h-4 text-primary-foreground"}),o(Me),e(he,Me)};D(ge,he=>{selectedImages.has(Y.url)&&he($e)})}var fe=s(ge,2);fe.__click=[Vt];var Fe=n(fe,!0);o(fe),o(me),q(he=>{Pt(ne,1,`aspect-square rounded-md overflow-hidden border-2 ${he??""} hover:border-primary/50 transition-colors`),Ue(_e,"src",Y.thumbnail),Ue(_e,"alt",Y.title||t($).latinName),Ue(fe,"href",Y.url),N(Fe,Y.source)},[()=>selectedImages.has(Y.url)?"border-primary":"border-transparent"]),e(Se,me)}),o(oe),e(pe,oe)};D(mt,pe=>{imageResults.length===0?pe(_t):pe(ft,!1)},!0)}e(ue,ke)};D(H,ue=>{imageResults.length===0&&selectedImages.size===0?ue(Ie):ue(pt,!1)},!0)}e(j,X)};D(y,j=>{loadingImages?j(de):j(ve,!1)})}var Re=s(y,2);se(Re,{onclick:lt,disabled:selectedImages.size<10,class:"mt-6 w-full",children:(j,X)=>{m();var H=A();q(()=>N(H,t(re)<t(B).length-1?"Next Plant":"Start Processing")),e(j,H)},$$slots:{default:!0}}),e(W,C)},$$slots:{default:!0}}),e(S,v)},$$slots:{default:!0}}),o(I),e(T,I)},Q=T=>{var $=te(),B=d($);{var re=k=>{xe(k,{children:(E,S)=>{var F=Yt(),v=d(F);Pe(v,{children:(b,W)=>{var M=Qt(),C=d(M);be(C,{children:(u,p)=>{m();var i=A("Processing Plants...");e(u,i)},$$slots:{default:!0}});var h=s(C,2);we(h,{children:(u,p)=>{m();var i=A();i.nodeValue=processingStatus,e(u,i)},$$slots:{default:!0}}),e(b,M)},$$slots:{default:!0}});var P=s(v,2);Ae(P,{children:(b,W)=>{var M=Xt(),C=d(M);He(C,{value:processingProgress});var h=s(C,2),u=n(h);Ke(u,{class:"w-8 h-8 animate-spin text-muted-foreground"}),o(h),e(b,M)},$$slots:{default:!0}}),e(E,F)},$$slots:{default:!0}})},I=k=>{var E=te(),S=d(E);{var F=v=>{xe(v,{children:(P,b)=>{var W=aa(),M=d(W);Pe(M,{children:(h,u)=>{var p=ea(),i=d(p);be(i,{class:"flex items-center gap-2",children:(w,J)=>{var y=Zt(),de=d(y);ze(de,{class:"w-6 h-6 text-green-600"}),m(),e(w,y)},$$slots:{default:!0}});var _=s(i,2);we(_,{children:(w,J)=>{m();var y=A();q(()=>N(y,`Successfully preprocessed ${t(K)??""}`)),e(w,y)},$$slots:{default:!0}}),e(h,p)},$$slots:{default:!0}});var C=s(M,2);Ae(C,{children:(h,u)=>{var p=ta(),i=n(p),_=s(n(i)),w=s(_,4);w.nodeValue=` ${manualPlants.length??""}`,o(i);var J=s(i,2);se(J,{onclick:Ve,class:"mt-4",children:(y,de)=>{m();var ve=A("Process Another File");e(y,ve)},$$slots:{default:!0}}),o(p),q(()=>N(_,` ${t(g).size??""} `)),e(h,p)},$$slots:{default:!0}}),e(P,W)},$$slots:{default:!0}})};D(S,v=>{t(z)==="complete"&&v(F)},!0)}e(k,E)};D(B,k=>{t(z)==="processing"?k(re):k(I,!1)},!0)}e(T,$)};D(ae,T=>{t(z)==="image-selection"?T(ce):T(Q,!1)},!0)}e(O,G)};D(x,O=>{t(z)==="plant-selection"?O(ee):O(U,!1)},!0)}e(a,r)};D(dt,a=>{t(z)==="file-selection"?a(vt):a(ut,!1)})}o(Ee),e(Z,Ee),Be()}$t(["change","click"]);export{_a as component};
