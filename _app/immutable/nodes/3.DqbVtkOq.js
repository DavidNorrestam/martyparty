import"../chunks/DsnmJJEf.js";import{i as fe}from"../chunks/DNgtaTqA.js";import{c as ke,s as H,e as X,o as Me,g as Ne}from"../chunks/DkkBxieF.js";import{h as re,a_ as qe,D as P,aV as Se,a1 as N,aX as je,a$ as Ce,p as ge,f as x,e as M,a4 as J,r as _,c as v,d as pe,s as L,a7 as z,a8 as E,j as a,ar as K,b0 as le,m as R,i as C,au as ue,av as Le,u as ce}from"../chunks/zngdAFSY.js";import{p as U,i as A,s as ze,a as Ae}from"../chunks/Chse6MBw.js";import{e as ne,i as oe,q as W}from"../chunks/iO6zg4Ln.js";import{r as de,s as G}from"../chunks/DwIY1aQq.js";import{s as Ie,g as me}from"../chunks/BVC5__Yd.js";import{r as he,a as Fe}from"../chunks/SYoqwPLj.js";function Qe(e,s){return e==null?null:String(e)}function Te(e,s,n,i){var r=e.__style;if(re||r!==s){var t=Qe(s);(!re||t!==e.getAttribute("style"))&&(t==null?e.removeAttribute("style"):e.style.cssText=t),e.__style=s}return i}function ve(e,s,n=s){var i=new WeakSet;qe(e,"input",async r=>{var t=r?e.defaultValue:e.value;if(t=te(e)?ae(t):t,n(t),P!==null&&i.add(P),await Se(),t!==(t=s())){var g=e.selectionStart,o=e.selectionEnd;e.value=t??"",o!==null&&(e.selectionStart=g,e.selectionEnd=Math.min(o,e.value.length))}}),(re&&e.defaultValue!==e.value||N(s)==null&&e.value)&&(n(te(e)?ae(e.value):e.value),P!==null&&i.add(P)),je(()=>{var r=s();if(e===document.activeElement){var t=Ce??P;if(i.has(t))return}te(e)&&r===ae(e.value)||e.type==="date"&&!r&&!e.value||r!==e.value&&(e.value=r??"")})}function te(e){var s=e.type;return s==="number"||s==="range"}function ae(e){return e===""?null:+e}function De(e){return function(...s){var n=s[0];return n.preventDefault(),e?.apply(this,s)}}const Re={id:"image-to-swedish",label:"Image → Swedish name",generateQuestions(e){return[...e].sort(()=>Math.random()-.5).map(n=>({...n,images:n.images||[],answer:n.swedishName}))},checkAnswer(e,s){return s.trim().toLowerCase()===e.swedishName.trim().toLowerCase()},getOptions(e,s){const n=e[s].answer,i=e.map(t=>t.answer),r=[n];for(;r.length<4&&i.length>r.length;){const t=i[Math.floor(Math.random()*i.length)];r.includes(t)||r.push(t)}return r.sort(()=>Math.random()-.5)}},Oe={id:"swedish-to-latin",label:"Swedish name → Latin name",generateQuestions(e){return[...e].sort(()=>Math.random()-.5).map(n=>({...n,question:n.swedishName,answer:n.latinName}))},checkAnswer(e,s){return s.trim().toLowerCase()===e.latinName.trim().toLowerCase()},getOptions(e,s){const n=e[s].answer,i=e.map(t=>t.answer),r=[n];for(;r.length<4&&i.length>r.length;){const t=i[Math.floor(Math.random()*i.length)];r.includes(t)||r.push(t)}return r.sort(()=>Math.random()-.5)}},Ve={id:"imageToNameFreetext",label:"Image to name (freetext)",generateQuestions:e=>[...e].sort(()=>Math.random()-.5).map(n=>({images:n.images||[],swedishName:n.swedishName||n.swedish||"",latinName:n.latinName||n.latin||"",answer:""})),checkAnswer:(e,s)=>{let n={};try{n=JSON.parse(s)}catch{return!1}const i=e.swedishName||"",r=e.latinName||"",t=n.swedish||"",g=n.latin||"",o=t.trim().toLowerCase()===i.trim().toLowerCase(),Q=g.trim().toLowerCase()===r.trim().toLowerCase();return o&&Q},getOptions:()=>[]},se=[Re,Oe,Ve];var $e=x('<li class="svelte-1cbt2hp"><button type="button" class="mode-toggle svelte-1cbt2hp"> </button></li>'),Pe=x('<h3 class="svelte-1cbt2hp">Vad är det svenska namnet för växten på bilden?</h3> <ul class="options-grid svelte-1cbt2hp"></ul>',1),Ee=x('<li class="svelte-1cbt2hp"><button type="button" class="mode-toggle svelte-1cbt2hp"> </button></li>'),Ue=x('<h3 class="svelte-1cbt2hp">Vad är det latinska namnet för <span> </span>?</h3> <ul class="options-grid svelte-1cbt2hp"></ul>',1),Be=x('<h3 class="svelte-1cbt2hp">Vad heter växten på bilderna? Ange både svenska och latinska namnet.</h3> <form style="display:flex;flex-direction:column;gap:1em;align-items:center;max-width:340px;width:100%;margin:0 auto;"><input type="text" placeholder="Svenskt namn" required autocomplete="off" style="font-size:1.1em;padding:0.7em 1em;border-radius:8px;border:1px solid #ccc;width:100%;"/> <input type="text" placeholder="Latinskt namn" required autocomplete="off" style="font-size:1.1em;padding:0.7em 1em;border-radius:8px;border:1px solid #ccc;width:100%;"/> <button type="submit" class="mode-toggle svelte-1cbt2hp" style="width:100%;">Svara</button></form>',1),Je=x('<div class="quiz-question svelte-1cbt2hp"><!></div>');function We(e,s){ge(s,!1);let n=U(s,"question",8),i=U(s,"options",8),r=U(s,"mode",8);const t=ke();let g=R(""),o=R("");function Q(y){t("answer",y)}function Y(y){y.preventDefault(),t("answer",JSON.stringify({swedish:a(g),latin:a(o)})),C(g,""),C(o,"")}fe();var O=Je(),Z=M(O);{var I=y=>{var F=Pe(),T=L(z(F),2);ne(T,5,i,oe,($,c)=>{var l=$e(),w=M(l),m=M(w,!0);_(w),_(l),E(()=>H(m,a(c))),X("click",w,()=>Q(a(c))),v($,l)}),_(T),v(y,F)},V=y=>{var F=K(),T=z(F);{var $=l=>{var w=Ue(),m=z(w),k=L(M(m)),p=M(k,!0);_(k),le(),_(m);var b=L(m,2);ne(b,5,i,oe,(q,u)=>{var h=Ee(),f=M(h),j=M(f,!0);_(f),_(h),E(()=>H(j,a(u))),X("click",f,()=>Q(a(u))),v(q,h)}),_(b),E(()=>H(p,(J(n()),N(()=>n().swedishName)))),v(l,w)},c=l=>{var w=K(),m=z(w);{var k=p=>{var b=Be(),q=L(z(b),2),u=M(q);de(u);var h=L(u,2);de(h),le(2),_(q),ve(u,()=>a(g),f=>C(g,f)),ve(h,()=>a(o),f=>C(o,f)),X("submit",q,De(Y)),v(p,b)};A(m,p=>{J(r()),N(()=>r()?.id==="imageToNameFreetext")&&p(k)},!0)}v(l,w)};A(T,l=>{J(r()),N(()=>r()?.id==="swedish-to-latin")?l($):l(c,!1)},!0)}v(y,F)};A(Z,y=>{J(r()),N(()=>r()?.id==="image-to-swedish")?y(I):y(V,!1)})}_(O),v(e,O),pe()}var He=x('<div class="quiz-progress svelte-4hxcfj" role="progressbar" tabindex="0"> <div class="progress-bar svelte-4hxcfj"><div class="progress svelte-4hxcfj"></div></div></div>');function Xe(e,s){let n=U(s,"current",8),i=U(s,"total",8);var r=He();G(r,"aria-valuemin",1);var t=M(r),g=L(t),o=M(g);_(g),_(r),E(()=>{G(r,"aria-valuenow",n()),G(r,"aria-valuemax",i()),H(t,`Fråga ${n()??""} av ${i()??""} `),Te(o,`width: ${100*n()/i()}%`)}),v(e,r)}const Ge=()=>{const e=Ie;return{page:{subscribe:e.page.subscribe},navigating:{subscribe:e.navigating.subscribe},updated:e.updated}},Ke={subscribe(e){return Ge().page.subscribe(e)}};var Ye=x("<p>Laddar frågor...</p>"),Ze=x('<img alt="Växtbild" style="max-width:260px;max-height:320px;width:100%;height:320px;object-fit:cover;border-radius:12px;box-shadow:0 2px 12px #0002;background:#e5e7eb;"/>'),et=x('<div style="display:inline-block;width:100%;max-width:260px;height:320px;border-radius:12px;background:#e5e7eb;box-shadow:0 2px 12px #0002;position:relative;"><span style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#888;">Laddar bild...</span></div>'),tt=x('<div style="text-align:center;margin-bottom:1em;display:flex;gap:1em;justify-content:center;overflow-x:auto;"><!></div>'),at=x("<!> <!> <!>",1),st=x("<p>Inga frågor tillgängliga.</p>"),rt=x('<main><button style="padding:0.3em 1em;font-size:1em;">Hem</button> <!></main>');function vt(e,s){ge(s,!1);const n=()=>Ae(W,"$quiz",i),[i,r]=ze(),t=R();let g=R(!0),o=R(void 0);async function Q(c){let l=c.latinName.replace(/"[^"]*"|'[^']*'/g,"").replace(/\s+sp\.?$/i,"").trim();c.latinName.trim().toLowerCase()==="antirrhinum majus"&&(l=l.split(" ")[0]);try{const m=await(await fetch(`https://api.inaturalist.org/v1/taxa?q=${encodeURIComponent(l)}`)).json();if(!m.results||m.results.length===0)return[];const k=m.results[0].id,b=await(await fetch(`https://api.inaturalist.org/v1/taxa/${k}`)).json();let q=[];b.results&&b.results.length>0&&b.results[0].taxon_photos&&(q=b.results[0].taxon_photos.map(h=>h.photo?.medium_url||h.photo?.url).filter(Boolean));let u=Array.from(new Set(q));if(u.length<3)try{const f=await(await fetch(`https://api.inaturalist.org/v1/observations?taxon_name=${encodeURIComponent(l)}&photos=true`)).json();if(f.results&&f.results.length>0){let j=f.results.flatMap(d=>(d.photos||[]).map(S=>S.medium_url||S.url)).filter(Boolean);for(let d=j.length-1;d>0;d--){const S=Math.floor(Math.random()*(d+1));[j[d],j[S]]=[j[S],j[d]]}for(const d of j){if(u.length>=3)break;u.includes(d)||u.push(d)}}}catch{}if(u.length>3){for(let h=u.length-1;h>0;h--){const f=Math.floor(Math.random()*(h+1));[u[h],u[f]]=[u[f],u[h]]}return u.slice(0,3)}else return u.length>0?u:[]}catch{return[]}}async function Y(c){const l=se.find(k=>k.id===c)||se[0];C(o,l),a(o).id,C(g,!0);let m=await(await fetch(Fe("/plants.json"))).json();a(o)&&(a(o).id==="image-to-swedish"||a(o).id==="imageToNameFreetext")&&(m=await Promise.all(m.map(async k=>{const p=await Q(k);return{...k,images:p}}))),a(o)&&W.start(m,a(o)),C(g,!1)}Me(()=>{const l=Ne(Ke).url.searchParams.get("mode")||se[0].id;return Y(l),W.subscribe(m=>{m.finished&&me(he("/result"))})});function O(c){W.answer(c)}function Z(c){return!a(t).questions.length||!a(o)?[]:a(o).getOptions(a(t).questions,c)}let I=R([]);ue(()=>n(),()=>{C(t,n())}),ue(()=>(a(o),a(t)),()=>{a(o)&&(a(o).id==="image-to-swedish"||a(o).id==="imageToNameFreetext")&&a(t).questions.length&&!a(t).finished?C(I,a(t).questions[a(t).current]?.images||[]):C(I,[])}),Le(),fe();var V=rt(),y=M(V),F=L(y,2);{var T=c=>{var l=Ye();v(c,l)},$=c=>{var l=K(),w=z(l);{var m=p=>{var b=at(),q=z(b);{let d=ce(()=>(a(t),N(()=>a(t).current+1)));Xe(q,{get current(){return a(d)},get total(){return a(t),N(()=>a(t).questions.length)}})}var u=L(q,2);{var h=d=>{var S=tt(),ee=M(S);{var be=D=>{var B=K(),_e=z(B);ne(_e,1,()=>a(I),oe,(xe,ye)=>{var ie=Ze();E(()=>G(ie,"src",a(ye))),v(xe,ie)}),v(D,B)},we=D=>{var B=et();v(D,B)};A(ee,D=>{a(I),N(()=>a(I).length>0)?D(be):D(we,!1)})}_(S),v(d,S)};A(u,d=>{a(o),N(()=>a(o)?.id==="image-to-swedish"||a(o)?.id==="imageToNameFreetext")&&d(h)})}var f=L(u,2);{var j=d=>{{let S=ce(()=>(a(t),N(()=>Z(a(t).current))));We(d,{get question(){return a(t),N(()=>a(t).questions[a(t).current])},get options(){return a(S)},get mode(){return a(o)},$$events:{answer:ee=>O(ee.detail)}})}};A(f,d=>{a(o)&&d(j)})}v(p,b)},k=p=>{var b=st();v(p,b)};A(w,p=>{a(t),N(()=>a(t).questions.length&&!a(t).finished)?p(m):p(k,!1)},!0)}v(c,l)};A(F,c=>{a(g)?c(T):c($,!1)})}_(V),X("click",y,()=>me(he("/"))),v(e,V),pe(),r()}export{vt as component};
